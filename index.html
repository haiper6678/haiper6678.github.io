<!DOCTYPE html>
<html>
<head>
<title>HTML5, CSS3 and JavaScript demo</title>
</head>
<body>
<script type="text/javascript", src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js"></script>
  <script type="text/javascript", src="https://cdn.jsdelivr.net/jstat/latest/jstat.min.js"></script>
<!-- Start your code here -->
  <p>前回の回転数
  <input type="number" min="0" data-bind="value: beforCount"></p>
  <p>回転数
  <input type="number" min="0" data-bind="value: count"></p>
  <p data-bind="text: nowCount"></p>
  <p>弱チェリー
  <input type="number" min="0" data-bind="value: lowCherry"></p>
  <p>単独紫7<input type="number" min="0" data-bind="value: soloP7"></p>
  <p>スイカ赤7<input type="number" min="0" data-bind="value: suikaR7"></p>
  <p>チャンスA異色7<input type="number" min="0" data-bind="value: chanceA7"></p>
  <p data-bind="text: total7"></p>
  <p>低確率スイカ合計<input type="number" min="0" data-bind="value: lowSuikaTotal"></p>
  <p>低確率スイカCZ当選<input type="number" min="0" data-bind="value: lowSuikaCZ"></p>
  <p>高確率スイカ合計<input type="number" min="0" data-bind="value: highSuikaTotal"></p>
  <p>高確率スイカCZ当選<input type="number" min="0" data-bind="value: highSuikaCZ"></p>
  <p>通常弱チェリー合計<input type="number" min="0" data-bind="value: nomalLowCherryTotal"></p>
  <p>通常弱チェリーCZ当選<input type="number" min="0" data-bind="value: nomalLowCherryCZ"></p>
<p data-bind="text: volume1"></p>
  <p data-bind="text: volume2"></p>
  <p data-bind="text: volume3"></p>
  <p data-bind="text: volume4"></p>
  <p data-bind="text: volume5"></p>
  <p data-bind="text: volume6"></p>
  <script >
  
// Write JavaScript here 
window.onload = function() {
    var viewModel = function(){
      var sum  = function(arr) {
        return arr.reduce(function(prev, current, i, arr) {
          return prev+current;
        });
       };
      this.beforCount = ko.observable(0);
      this.count = ko.observable(0);
      this.nowCount = ko.computed(function() {
        var count = this.count() - this.beforCount();
        return ((count >= 0) ? count : 0);
      }, this);
      
      this.lowCherry = ko.observable(0);
      this.soloP7 = ko.observable(0);
      this.suikaR7 = ko.observable(0);
      this.chanceA7 = ko.observable(0);
      this.total7 = ko.computed(function(){
        return ((this.soloP7() - 0) + (this.suikaR7()-0) + (this.chanceA7()-0));
      },this);
      
      this.lowSuikaTotal = ko.observable(0);
      this.lowSuikaCZ = ko.observable(0);
      this.highSuikaTotal = ko.observable(0);
      this.highSuikaCZ = ko.observable(0);
      this.nomalLowCherryTotal = ko.observable(0);
      this.nomalLowCherryCZ = ko.observable(0);
      
      this.totalVolume = ko.computed(function() {
        var lowCherryP = [
          1/108.9,
          1/102.2,
          1/96.2,
          1/91.0,
          1/86.1,
          1/81.5
        ];
        
        var tokusyu7P = [
          1/1725,
          1/1725,
          1/1490,
          1/1260,
          1/1008,
          1/819
        ];
        
        var lowSuikaCZP = [
          0.125,
          0.125,
          0.176,
          0.176,
          0.25,
          0.25
        ];
        
        var highSuikaCZP = [
          0.25,
          0.25,
          0.25,
          0.336,
          0.336,
          0.336
        ];
        
        var nomalCherryCZP = [
          0.004,
          0.004,
          0.023,
          0.047,
          0.035
        ];
        var volume = [
          1,1,1,1,1,1
        ];
        
        for(var i=0; i<6;i++){
          volume[i] = volume[i] * jStat.binomial.pdf(this.lowCherry()- 0,
                                                     this.nowCount()- 0,
                                                     lowCherryP[i]);
          volume[i] = volume[i] * jStat.binomial.pdf(this.total7()- 0,
                                                     this.nowCount()- 0,
                                                     tokusyu7P[i]);
          volume[i] = volume[i] * jStat.binomial.pdf(this.lowSuikaCZ()- 0,
                                                     this.lowSuikaTotal()- 0,
                                                     lowSuikaCZP[i]);
          volume[i] = volume[i] * jStat.binomial.pdf(this.highSuikaCZ()- 0,
                                                     this.highSuikaTotal()- 0,
                                                     lowSuikaCZP[i]);
        }
        return volume;
      }, this);
      
      this.volume1 = ko.computed(function() {
        return this.totalVolume()[0] / sum(this.totalVolume());
      }, this);
      this.volume2 = ko.computed(function() {
        return this.totalVolume()[1] / sum(this.totalVolume());
      }, this);
      this.volume3 = ko.computed(function() {
        return this.totalVolume()[2] / sum(this.totalVolume());
      }, this);
      this.volume4 = ko.computed(function() {
        return this.totalVolume()[3] / sum(this.totalVolume());
      }, this);
      this.volume5 = ko.computed(function() {
        return this.totalVolume()[4] / sum(this.totalVolume());
      }, this);
      this.volume6 = ko.computed(function() {
        return this.totalVolume()[5] / sum(this.totalVolume());
      }, this);
    };
    ko.applyBindings(viewModel);
};
  </script>
<!-- End your code here -->
</body>
</html>

